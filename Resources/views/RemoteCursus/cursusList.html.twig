{% macro showSecondLevel(cursus, children) %}
    {% set cursusId = cursus['id'] %}
    
    {% if children[cursusId] is defined %}
        
        {% for child in children[cursusId] %}
    
            {% if child['course']['title'] is defined %}
                <div class="col-md-offset-1">
                    <i class="fa fa-book"></i>
                    {{ child['course']['title'] }}
                </div>
            {% else %}
                
                {% if not loop.first %}
                    <br>
                {% endif %}
                <div>
                    <b>
                        {{ child['title'] }}
                    </b>
                </div>
                {{ _self.showSecondLevel(child, children) }}
            {% endif %}
        {% endfor %}
    {% endif %}
{% endmacro %}


{% macro showFirstLevel(root, children) %}
    {% set rootId = root['id'] %}
    
    {% if children[rootId] is defined %}
        
        {% for child in children[rootId] %}
            {% set index = (loop.index0 / 2)|round(0, 'floor') %}
            
            {% if loop.index0 is divisible by(2) %}
                <div class="cursus-group-row">
            {% endif %}
            
            {% if child['details']['color'] is defined %}
                {% set hasColor = true %}
                {% set color = child['details']['color'] %}
            {% else %}
                {% set hasColor = false %}
            {% endif %}
            <div class="col-md-6">
                <div class="panel panel-default cursus-panel cursus-panel-{{ rootId }}-{{ index }}"
                     data-index="{{ index }}"
                     data-root-id="{{ rootId }}"
                     {% if hasColor %}style="border-color: {{ color }}"{% endif %}
                >
                    <div class="panel-heading" {% if hasColor %}style="background-color: {{ color }}"{% endif %}>
                        <div class="panel-title">
                            {{ child['title'] }}
                        </div>
                    </div>
                    <div class="panel-body">
                        {{ _self.showSecondLevel(child, children) }}
                    </div>
                </div>
            </div>
            
            {% if loop.index0 is not divisible by(2) or loop.last %}
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
{% endmacro %}

{% from _self import showFirstLevel %}
{% from _self import showSecondLevel %}

{% extends 'ClarolineCoreBundle::layout.html.twig' %}

{% block content %}
    <div class="panel panel-default" id="cursus-list">
        <div class="panel-body">
                    
            {% for root in roots %}
                {% if root['details']['color'] is defined %}
                    {% set hasColor = true %}
                    {% set color = root['details']['color'] %}
                {% else %}
                    {% set hasColor = false %}
                {% endif %}
                <div class="panel panel-default cursus-root-panel" {% if hasColor %}style="border-color: {{ color }}"{% endif %}>
                    <div class="panel-heading" {% if hasColor %}style="background-color: {{ color }}"{% endif %}>
                        <div class="panel-title">
                            <h3>
                                {{ root['title'] }}
                            </h3>
                        </div>
                    </div>
                    <div class="panel-body cursus-root-content">
                        {{ showFirstLevel(root, cursusChildren) }}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript"
            src="{{ url('bazinga_jstranslation_js', { 'domain': 'remoteCursus' }) }}"
    >
    </script>
    <script src='{{ asset('bundles/formalibreclarolinecomtheme/js/cursusList.js') }}'
            type="text/javascript"
    >
    </script>
{% endblock %}